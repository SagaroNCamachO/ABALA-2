<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ABALA - Gesti√≥n de Campeonatos</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }
        
        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        @media (max-width: 968px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }
        
        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .card h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.4em;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            color: #333;
            font-weight: 600;
            font-size: 0.9em;
        }
        
        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 14px 30px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
            margin-top: 10px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn-secondary {
            background: #6c757d;
            margin-top: 5px;
        }
        
        .btn-secondary:hover {
            background: #5a6268;
        }
        
        .data-section {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .data-item {
            background: #f8f9fa;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .data-item:hover {
            background: #e9ecef;
            transform: translateX(5px);
        }
        
        .data-item strong {
            color: #667eea;
            display: block;
            margin-bottom: 5px;
        }
        
        .data-item .info {
            font-size: 0.85em;
            color: #666;
        }
        
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
        }
        
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border: none;
            background: none;
            font-size: 16px;
            color: #666;
            font-weight: 600;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }
        
        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .response {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #28a745;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .response pre {
            white-space: pre-wrap;
            word-wrap: break-word;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            margin: 0;
        }
        
        .status-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            margin-left: 10px;
        }
        
        .status-badge.success {
            background: #d4edda;
            color: #155724;
        }
        
        .status-badge.info {
            background: #d1ecf1;
            color: #0c5460;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px;
            color: #999;
        }
        
        .empty-state::before {
            content: "üìã";
            font-size: 3em;
            display: block;
            margin-bottom: 10px;
        }
        
        .chips {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-top: 8px;
        }
        
        .chip {
            background: #667eea;
            color: white;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
        }
        
        .alert {
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-size: 0.9em;
        }
        
        .alert-success {
            background: #d4edda;
            color: #155724;
            border-left: 4px solid #28a745;
        }
        
        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border-left: 4px solid #dc3545;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üèÄ ABALA</h1>
            <p style="font-size: 1.1em; opacity: 0.95;">Sistema de Gesti√≥n de Campeonatos de B√°squetbol</p>
        </div>
        
        <div class="main-grid">
            <!-- Panel Izquierdo: Crear/Gestionar -->
            <div class="card">
                <h2>‚öôÔ∏è Gesti√≥n</h2>
                
                <div class="tabs">
                    <button class="tab active" onclick="switchTab('create')">Crear</button>
                    <button class="tab" onclick="switchTab('manage')">Gestionar</button>
                </div>
                
                <!-- Tab: Crear -->
                <div id="createTab" class="tab-content active">
                    <div class="form-group">
                        <label>Acci√≥n:</label>
                        <select id="actionSelect" onchange="updateForm()">
                            <option value="createChamp">Crear Campeonato</option>
                            <option value="addCategory">Agregar Categor√≠a</option>
                            <option value="registerResult">Registrar Resultado</option>
                            <option value="applyPenalty">Aplicar Multa</option>
                        </select>
                    </div>
                    
                    <div id="dynamicForm"></div>
                    
                    <button class="btn" onclick="executeAction()">Ejecutar</button>
                    <button class="btn btn-secondary" onclick="loadData()">üîÑ Actualizar Datos</button>
                </div>
                
                <!-- Tab: Gestionar -->
                <div id="manageTab" class="tab-content">
                    <div class="form-group">
                        <label>Ver:</label>
                        <select id="viewSelect" onchange="loadView()">
                            <option value="standings">Tabla de Posiciones</option>
                            <option value="fixture">Fixture</option>
                            <option value="championship">Campeonato Completo</option>
                        </select>
                    </div>
                    
                    <div id="viewForm"></div>
                    <button class="btn" onclick="loadViewData()">Ver</button>
                </div>
            </div>
            
            <!-- Panel Derecho: Datos Creados -->
            <div class="card">
                <h2>üìä Datos Creados</h2>
                
                <div class="tabs">
                    <button class="tab active" onclick="switchDataTab('championships')">Campeonatos</button>
                    <button class="tab" onclick="switchDataTab('categories')">Categor√≠as</button>
                </div>
                
                <div id="championshipsTab" class="tab-content active data-section">
                    <div id="championshipsList"></div>
                </div>
                
                <div id="categoriesTab" class="tab-content data-section">
                    <div id="categoriesList"></div>
                </div>
            </div>
        </div>
        
        <!-- Respuesta -->
        <div class="card" id="responseCard" style="display: none;">
            <h2>üì§ Respuesta</h2>
            <div id="response" class="response"></div>
        </div>
    </div>
    
    <script>
        const API_BASE = window.location.origin;
        let championshipsData = {};
        let categoriesData = {};
        
        // Cargar datos al iniciar
        window.onload = () => {
            loadData();
        };
        
        function switchTab(tab) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            
            if (tab === 'create') {
                document.querySelectorAll('.tab')[0].classList.add('active');
                document.getElementById('createTab').classList.add('active');
            } else {
                document.querySelectorAll('.tab')[1].classList.add('active');
                document.getElementById('manageTab').classList.add('active');
            }
        }
        
        function switchDataTab(tab) {
            document.querySelectorAll('#championshipsTab, #categoriesTab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab').forEach((t, i) => {
                if ((tab === 'championships' && i === 0) || (tab === 'categories' && i === 1)) {
                    t.classList.add('active');
                } else {
                    t.classList.remove('active');
                }
            });
            
            if (tab === 'championships') {
                document.getElementById('championshipsTab').classList.add('active');
            } else {
                document.getElementById('categoriesTab').classList.add('active');
            }
        }
        
        async function loadData() {
            try {
                // Primero obtener la lista de campeonatos
                const res = await fetch(`${API_BASE}/api/championships`);
                const data = await res.json();
                
                if (data.success) {
                    const champList = data.championships || {};
                    championshipsData = {};
                    categoriesData = {};
                    
                    // Cargar datos completos de cada campeonato
                    const loadPromises = Object.keys(champList).map(async (id) => {
                        try {
                            const champRes = await fetch(`${API_BASE}/api/championships/${id}`);
                            const champData = await champRes.json();
                            
                            if (champData.success && champData.championship) {
                                championshipsData[id] = {
                                    name: champData.championship.name,
                                    rounds: champData.championship.rounds,
                                    points_per_win: champData.championship.points_per_win,
                                    points_per_loss: champData.championship.points_per_loss,
                                    categories: champData.championship.categories || {}
                                };
                                
                                // Extraer categor√≠as con equipos
                                if (champData.championship.categories) {
                                    categoriesData[id] = champData.championship.categories;
                                }
                            } else {
                                // Si falla, usar datos del resumen
                                championshipsData[id] = champList[id];
                            }
                        } catch (error) {
                            console.error(`Error cargando campeonato ${id}:`, error);
                            championshipsData[id] = champList[id];
                        }
                    });
                    
                    await Promise.all(loadPromises);
                    
                    renderChampionships();
                    renderCategories();
                    updateForm(); // Actualizar formularios con datos disponibles
                }
            } catch (error) {
                console.error('Error cargando datos:', error);
                showAlert('Error al cargar datos: ' + error.message, 'error');
            }
        }
        
        function renderChampionships() {
            const list = document.getElementById('championshipsList');
            
            if (Object.keys(championshipsData).length === 0) {
                list.innerHTML = '<div class="empty-state">No hay campeonatos creados</div>';
                return;
            }
            
            list.innerHTML = Object.entries(championshipsData).map(([id, champ]) => `
                <div class="data-item" onclick="selectChampionship('${id}')">
                    <strong>${champ.name || id}</strong>
                    <div class="info">
                        ID: ${id}<br>
                        Vueltas: ${champ.rounds || 'N/A'}<br>
                        Categor√≠as: ${champ.categories ? Object.keys(champ.categories).length : 0}
                    </div>
                    ${champ.categories ? `<div class="chips">${Object.keys(champ.categories).map(cat => `<span class="chip">${cat}</span>`).join('')}</div>` : ''}
                </div>
            `).join('');
        }
        
        function renderCategories() {
            const list = document.getElementById('categoriesList');
            
            if (Object.keys(categoriesData).length === 0) {
                list.innerHTML = '<div class="empty-state">No hay categor√≠as creadas</div>';
                return;
            }
            
            let html = '';
            for (const [champId, categories] of Object.entries(categoriesData)) {
                for (const [catName, cat] of Object.entries(categories)) {
                    html += `
                        <div class="data-item" onclick="selectCategory('${champId}', '${catName}')">
                            <strong>${catName}</strong>
                            <div class="info">
                                Campeonato: ${championshipsData[champId]?.name || champId}<br>
                                Equipos: ${cat.teams ? cat.teams.length : 0}<br>
                                Partidos: ${cat.matches ? cat.matches.length : 0}
                            </div>
                        </div>
                    `;
                }
            }
            list.innerHTML = html || '<div class="empty-state">No hay categor√≠as</div>';
        }
        
        function selectChampionship(id) {
            const champ = championshipsData[id];
            if (!champ) return;
            
            // Auto-rellenar formularios
            document.getElementById('champId')?.setAttribute('value', id);
            document.getElementById('champIdSelect')?.setAttribute('value', id);
            document.getElementById('champIdView')?.setAttribute('value', id);
            
            // Mostrar alerta
            showAlert(`Campeonato "${champ.name || id}" seleccionado`, 'success');
        }
        
        function selectCategory(champId, catName) {
            // Auto-rellenar formularios
            document.getElementById('categoryName')?.setAttribute('value', catName);
            document.getElementById('categorySelect')?.setAttribute('value', catName);
            document.getElementById('categoryView')?.setAttribute('value', catName);
            document.getElementById('champId')?.setAttribute('value', champId);
            
            showAlert(`Categor√≠a "${catName}" seleccionada`, 'success');
        }
        
        function updateForm() {
            const action = document.getElementById('actionSelect').value;
            const formDiv = document.getElementById('dynamicForm');
            let html = '';
            
            // Obtener IDs de campeonatos disponibles
            const champIds = Object.keys(championshipsData);
            const champOptions = champIds.length > 0 
                ? champIds.map(id => `<option value="${id}">${championshipsData[id].name || id}</option>`).join('')
                : '<option value="">No hay campeonatos</option>';
            
            switch(action) {
                case 'createChamp':
                    html = `
                        <div class="form-group">
                            <label>ID del Campeonato:</label>
                            <input type="text" id="champId" placeholder="champ1" value="champ${champIds.length + 1}">
                        </div>
                        <div class="form-group">
                            <label>Nombre:</label>
                            <input type="text" id="name" placeholder="Campeonato 2024" value="Campeonato ${new Date().getFullYear()}">
                        </div>
                        <div class="form-group">
                            <label>Vueltas:</label>
                            <input type="number" id="rounds" value="2" min="1">
                        </div>
                        <div class="form-group">
                            <label>Puntos por Victoria:</label>
                            <input type="number" id="pointsWin" value="2" min="0">
                        </div>
                        <div class="form-group">
                            <label>Puntos por Derrota:</label>
                            <input type="number" id="pointsLoss" value="0" min="0">
                        </div>
                    `;
                    break;
                case 'addCategory':
                    html = `
                        <div class="form-group">
                            <label>Campeonato:</label>
                            <select id="champIdSelect" onchange="loadCategoryTeams()">
                                ${champOptions}
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Nombre de la Categor√≠a:</label>
                            <input type="text" id="categoryName" placeholder="TC" list="categorySuggestions">
                            <datalist id="categorySuggestions">
                                <option value="TC">
                                <option value="Senior">
                                <option value="Super Senior">
                            </datalist>
                        </div>
                        <div class="form-group">
                            <label>Equipos (separados por comas):</label>
                            <input type="text" id="teams" placeholder="Equipo A, Equipo B, Equipo C">
                        </div>
                        <div class="form-group">
                            <label>O n√∫mero de equipos (nombres autom√°ticos):</label>
                            <input type="number" id="numTeams" placeholder="4" min="2">
                        </div>
                    `;
                    break;
                case 'registerResult':
                    html = `
                        <div class="form-group">
                            <label>Campeonato:</label>
                            <select id="champIdSelect" onchange="loadCategoryTeams()">
                                ${champOptions}
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Categor√≠a:</label>
                            <select id="categorySelect" onchange="loadTeams()">
                                <option value="">Selecciona categor√≠a</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Equipo A:</label>
                            <select id="teamA">
                                <option value="">Selecciona equipo</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Equipo B:</label>
                            <select id="teamB">
                                <option value="">Selecciona equipo</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Vuelta:</label>
                            <input type="number" id="roundNumber" value="1" min="1">
                        </div>
                        <div class="form-group">
                            <label>Puntos Equipo A:</label>
                            <input type="number" id="scoreA" value="0" min="0">
                        </div>
                        <div class="form-group">
                            <label>Puntos Equipo B:</label>
                            <input type="number" id="scoreB" value="0" min="0">
                        </div>
                    `;
                    if (champIds.length > 0) {
                        setTimeout(() => loadCategoryTeams(), 100);
                    }
                    break;
                case 'applyPenalty':
                    html = `
                        <div class="form-group">
                            <label>Campeonato:</label>
                            <select id="champIdSelect" onchange="loadCategoryTeams()">
                                ${champOptions}
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Categor√≠a:</label>
                            <select id="categorySelect" onchange="loadTeams()">
                                <option value="">Selecciona categor√≠a</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Equipo:</label>
                            <select id="teamSelect">
                                <option value="">Selecciona equipo</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Puntos (positivo para multa, negativo para bonificaci√≥n):</label>
                            <input type="number" id="penaltyPoints" value="0">
                        </div>
                    `;
                    if (champIds.length > 0) {
                        setTimeout(() => loadCategoryTeams(), 100);
                    }
                    break;
            }
            
            formDiv.innerHTML = html;
        }
        
        function loadCategoryTeams() {
            const champId = document.getElementById('champIdSelect')?.value;
            if (!champId || !championshipsData[champId]) return;
            
            const categories = categoriesData[champId] || {};
            const categorySelect = document.getElementById('categorySelect');
            
            if (categorySelect) {
                categorySelect.innerHTML = '<option value="">Selecciona categor√≠a</option>' +
                    Object.keys(categories).map(cat => 
                        `<option value="${cat}">${cat}</option>`
                    ).join('');
                
                categorySelect.onchange = loadTeams;
            }
            
            loadTeams();
        }
        
        function loadTeams() {
            const champId = document.getElementById('champIdSelect')?.value;
            const category = document.getElementById('categorySelect')?.value;
            
            if (!champId || !category || !categoriesData[champId] || !categoriesData[champId][category]) {
                return;
            }
            
            const teams = categoriesData[champId][category].teams || [];
            const teamOptions = teams.map(team => 
                `<option value="${team.name || team}">${team.name || team}</option>`
            ).join('');
            
            ['teamA', 'teamB', 'teamSelect'].forEach(id => {
                const select = document.getElementById(id);
                if (select) {
                    select.innerHTML = '<option value="">Selecciona equipo</option>' + teamOptions;
                }
            });
        }
        
        async function executeAction() {
            const action = document.getElementById('actionSelect').value;
            const responseDiv = document.getElementById('response');
            const responseCard = document.getElementById('responseCard');
            
            responseCard.style.display = 'block';
            responseDiv.innerHTML = '<pre>Cargando...</pre>';
            
            let url, options = {};
            
            try {
                switch(action) {
                    case 'createChamp':
                        url = `${API_BASE}/api/championships`;
                        options = {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                id: document.getElementById('champId').value,
                                name: document.getElementById('name').value,
                                rounds: parseInt(document.getElementById('rounds').value),
                                points_per_win: parseInt(document.getElementById('pointsWin').value),
                                points_per_loss: parseInt(document.getElementById('pointsLoss').value)
                            })
                        };
                        break;
                    case 'addCategory':
                        const champId = document.getElementById('champIdSelect').value;
                        
                        if (!champId) {
                            showAlert('Por favor selecciona un campeonato', 'error');
                            return;
                        }
                        
                        const categoryName = document.getElementById('categoryName').value;
                        if (!categoryName) {
                            showAlert('Por favor ingresa el nombre de la categor√≠a', 'error');
                            return;
                        }
                        
                        url = `${API_BASE}/api/championships/${champId}/categories`;
                        const teamsInput = document.getElementById('teams').value;
                        const numTeams = document.getElementById('numTeams').value;
                        
                        const body = {
                            name: categoryName
                        };
                        
                        if (teamsInput && teamsInput.trim()) {
                            const teams = teamsInput.split(',').map(t => t.trim()).filter(t => t.length > 0);
                            if (teams.length > 0) {
                                body.teams = teams;
                            } else {
                                showAlert('Por favor ingresa al menos un equipo', 'error');
                                return;
                            }
                        } else if (numTeams && parseInt(numTeams) >= 2) {
                            body.num_teams = parseInt(numTeams);
                        } else {
                            showAlert('Debes proporcionar equipos (separados por comas) o un n√∫mero de equipos (m√≠nimo 2)', 'error');
                            return;
                        }
                        
                        options = {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(body)
                        };
                        break;
                    case 'registerResult':
                        const champId2 = document.getElementById('champIdSelect').value;
                        url = `${API_BASE}/api/championships/${champId2}/results`;
                        options = {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                category: document.getElementById('categorySelect').value,
                                team_a: document.getElementById('teamA').value,
                                team_b: document.getElementById('teamB').value,
                                round_number: parseInt(document.getElementById('roundNumber').value),
                                score_a: parseInt(document.getElementById('scoreA').value),
                                score_b: parseInt(document.getElementById('scoreB').value)
                            })
                        };
                        break;
                    case 'applyPenalty':
                        const champId3 = document.getElementById('champIdSelect').value;
                        url = `${API_BASE}/api/championships/${champId3}/penalty`;
                        options = {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                category: document.getElementById('categorySelect').value,
                                team: document.getElementById('teamSelect').value,
                                points: parseInt(document.getElementById('penaltyPoints').value)
                            })
                        };
                        break;
                }
                
                const res = await fetch(url, options);
                const data = await res.json();
                
                responseDiv.innerHTML = `<pre>${JSON.stringify(data, null, 2)}</pre>`;
                
                if (data.success) {
                    showAlert('Operaci√≥n exitosa', 'success');
                    // Recargar datos despu√©s de crear/modificar
                    if (action === 'createChamp' || action === 'addCategory' || action === 'registerResult') {
                        setTimeout(() => loadData(), 1000);
                    }
                } else {
                    showAlert(data.error || 'Error en la operaci√≥n', 'error');
                }
            } catch (error) {
                responseDiv.innerHTML = `<pre style="color: red;">Error: ${error.message}</pre>`;
                showAlert('Error de conexi√≥n', 'error');
            }
        }
        
        function loadView() {
            const view = document.getElementById('viewSelect').value;
            const formDiv = document.getElementById('viewForm');
            const champIds = Object.keys(championshipsData);
            const champOptions = champIds.map(id => `<option value="${id}">${championshipsData[id].name || id}</option>`).join('');
            
            let html = `
                <div class="form-group">
                    <label>Campeonato:</label>
                    <select id="champIdView" onchange="loadViewCategories()">
                        ${champOptions}
                    </select>
                </div>
            `;
            
            if (view === 'standings' || view === 'fixture') {
                html += `
                    <div class="form-group">
                        <label>Categor√≠a:</label>
                        <select id="categoryView">
                            <option value="">Selecciona categor√≠a</option>
                        </select>
                    </div>
                `;
                
                if (view === 'fixture') {
                    html += `
                        <div class="form-group">
                            <label>Vuelta (opcional):</label>
                            <input type="number" id="roundView" placeholder="Dejar vac√≠o para todas" min="1">
                        </div>
                    `;
                }
            }
            
            formDiv.innerHTML = html;
            if (champIds.length > 0) {
                setTimeout(() => loadViewCategories(), 100);
            }
        }
        
        function loadViewCategories() {
            const champId = document.getElementById('champIdView')?.value;
            if (!champId || !categoriesData[champId]) return;
            
            const categories = Object.keys(categoriesData[champId]);
            const categoryView = document.getElementById('categoryView');
            
            if (categoryView) {
                categoryView.innerHTML = '<option value="">Selecciona categor√≠a</option>' +
                    categories.map(cat => `<option value="${cat}">${cat}</option>`).join('');
            }
        }
        
        async function loadViewData() {
            const view = document.getElementById('viewSelect').value;
            const champId = document.getElementById('champIdView')?.value;
            const responseDiv = document.getElementById('response');
            const responseCard = document.getElementById('responseCard');
            
            if (!champId) {
                showAlert('Selecciona un campeonato', 'error');
                return;
            }
            
            responseCard.style.display = 'block';
            responseDiv.innerHTML = '<pre>Cargando...</pre>';
            
            try {
                let url;
                
                if (view === 'standings') {
                    const category = document.getElementById('categoryView').value;
                    if (!category) {
                        showAlert('Selecciona una categor√≠a', 'error');
                        return;
                    }
                    url = `${API_BASE}/api/championships/${champId}/standings/${category}`;
                } else if (view === 'fixture') {
                    const category = document.getElementById('categoryView').value;
                    if (!category) {
                        showAlert('Selecciona una categor√≠a', 'error');
                        return;
                    }
                    const round = document.getElementById('roundView').value;
                    url = `${API_BASE}/api/championships/${champId}/fixture/${category}`;
                    if (round) url += `?round=${round}`;
                    window.currentCategory = category; // Guardar para usar en renderFixture
                } else {
                    url = `${API_BASE}/api/championships/${champId}`;
                }
                
                const res = await fetch(url);
                const data = await res.json();
                
                if (!data.success) {
                    showAlert(data.error || 'Error', 'error');
                    responseDiv.innerHTML = `<pre>${JSON.stringify(data, null, 2)}</pre>`;
                    return;
                }
                
                // Renderizar seg√∫n el tipo de vista
                if (view === 'fixture' && data.matches) {
                    const category = document.getElementById('categoryView').value;
                    responseDiv.innerHTML = renderFixture(data.matches, category || 'Categor√≠a');
                } else if (view === 'standings' && data.standings) {
                    responseDiv.innerHTML = renderStandings(data.standings);
                } else {
                    responseDiv.innerHTML = `<pre>${JSON.stringify(data, null, 2)}</pre>`;
                }
            } catch (error) {
                responseDiv.innerHTML = `<pre style="color: red;">Error: ${error.message}</pre>`;
                showAlert('Error de conexi√≥n', 'error');
            }
        }
        
        function renderFixture(matches, categoryName) {
            if (!matches || matches.length === 0) {
                return '<div class="empty-state">No hay partidos en el fixture</div>';
            }
            
            // Agrupar partidos por vuelta
            const matchesByRound = {};
            matches.forEach(match => {
                const round = match.round_number || 1;
                if (!matchesByRound[round]) {
                    matchesByRound[round] = [];
                }
                matchesByRound[round].push(match);
            });
            
            let html = `<div style="padding: 10px;"><h3 style="color: #667eea; margin-bottom: 20px;">üìÖ Fixture - ${categoryName}</h3>`;
            
            // Ordenar vueltas
            const rounds = Object.keys(matchesByRound).sort((a, b) => parseInt(a) - parseInt(b));
            
            rounds.forEach(round => {
                const roundMatches = matchesByRound[round];
                const matchType = roundMatches[0]?.match_type || 'ida';
                
                html += `
                    <div style="margin-bottom: 30px; border: 2px solid #e0e0e0; border-radius: 10px; padding: 15px; background: #f8f9fa;">
                        <h4 style="color: #667eea; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                            <span>Vuelta ${round}</span>
                            <span style="font-size: 0.8em; color: #666; font-weight: normal;">(${matchType})</span>
                        </h4>
                        <div style="display: grid; gap: 10px;">
                `;
                
                roundMatches.forEach(match => {
                    const played = match.played;
                    const scoreA = match.score_a !== null ? match.score_a : '-';
                    const scoreB = match.score_b !== null ? match.score_b : '-';
                    const winner = match.winner;
                    
                    html += `
                        <div style="display: flex; align-items: center; justify-content: space-between; padding: 12px; background: white; border-radius: 8px; border-left: 4px solid ${played ? '#28a745' : '#667eea'};">
                            <div style="flex: 1; text-align: right;">
                                <strong style="color: ${winner === match.team_a ? '#28a745' : '#333'}">${match.team_a}</strong>
                            </div>
                            <div style="padding: 0 20px; font-weight: bold; font-size: 1.2em; color: ${played ? '#28a745' : '#666'}">
                                ${scoreA} - ${scoreB}
                            </div>
                            <div style="flex: 1; text-align: left;">
                                <strong style="color: ${winner === match.team_b ? '#28a745' : '#333'}">${match.team_b}</strong>
                            </div>
                            ${played ? '<span style="margin-left: 10px; color: #28a745;">‚úì</span>' : '<span style="margin-left: 10px; color: #999;">Pendiente</span>'}
                        </div>
                    `;
                });
                
                html += `</div></div>`;
            });
            
            html += `</div>`;
            return html;
        }
        
        function renderStandings(standings) {
            if (!standings || standings.length === 0) {
                return '<div class="empty-state">No hay datos en la tabla de posiciones</div>';
            }
            
            let html = `
                <div style="padding: 10px; overflow-x: auto;">
                    <h3 style="color: #667eea; margin-bottom: 20px;">üìä Tabla de Posiciones</h3>
                    <table style="width: 100%; border-collapse: collapse; background: white; border-radius: 8px; overflow: hidden;">
                        <thead>
                            <tr style="background: #667eea; color: white;">
                                <th style="padding: 12px; text-align: left;">Pos</th>
                                <th style="padding: 12px; text-align: left;">Equipo</th>
                                <th style="padding: 12px; text-align: center;">PJ</th>
                                <th style="padding: 12px; text-align: center;">PG</th>
                                <th style="padding: 12px; text-align: center;">PP</th>
                                <th style="padding: 12px; text-align: center;">PF</th>
                                <th style="padding: 12px; text-align: center;">PC</th>
                                <th style="padding: 12px; text-align: center;">Dif</th>
                                <th style="padding: 12px; text-align: center; font-weight: bold;">Pts</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            standings.forEach((team, index) => {
                const position = index + 1;
                const medal = position === 1 ? 'ü•á' : position === 2 ? 'ü•à' : position === 3 ? 'ü•â' : '';
                const rowColor = position <= 3 ? '#f0f8ff' : index % 2 === 0 ? '#ffffff' : '#f8f9fa';
                
                html += `
                    <tr style="background: ${rowColor};">
                        <td style="padding: 12px; font-weight: bold; color: #667eea;">${position} ${medal}</td>
                        <td style="padding: 12px; font-weight: 600;">${team.name}</td>
                        <td style="padding: 12px; text-align: center;">${team.pj || 0}</td>
                        <td style="padding: 12px; text-align: center; color: #28a745;">${team.pg || 0}</td>
                        <td style="padding: 12px; text-align: center; color: #dc3545;">${team.pp || 0}</td>
                        <td style="padding: 12px; text-align: center;">${team.pf || 0}</td>
                        <td style="padding: 12px; text-align: center;">${team.pc || 0}</td>
                        <td style="padding: 12px; text-align: center; color: ${team.difference >= 0 ? '#28a745' : '#dc3545'};">${team.difference || 0}</td>
                        <td style="padding: 12px; text-align: center; font-weight: bold; color: #667eea; font-size: 1.1em;">${team.points || 0}</td>
                    </tr>
                `;
            });
            
            html += `
                        </tbody>
                    </table>
                </div>
            `;
            
            return html;
        }
        
        function showAlert(message, type) {
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.textContent = message;
            alert.style.position = 'fixed';
            alert.style.top = '20px';
            alert.style.right = '20px';
            alert.style.zIndex = '1000';
            alert.style.minWidth = '300px';
            document.body.appendChild(alert);
            
            setTimeout(() => {
                alert.style.opacity = '0';
                alert.style.transition = 'opacity 0.3s';
                setTimeout(() => alert.remove(), 300);
            }, 3000);
        }
        
        // Inicializar
        updateForm();
    </script>
</body>
</html>
